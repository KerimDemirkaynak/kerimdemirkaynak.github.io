<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notlarım</title>
  <style>
    body {
      font-family: sans-serif;
      background: #1a1a1d;
      color: #eee;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }
    .app-container {
      background: #252528;
      border-radius: 12px;
      padding: 20px;
      width: 100%;
      max-width: 700px;
      border: 1px solid #3a3a3c;
    }
    textarea {
      width: 100%;
      height: 250px;
      background: #1a1a1d;
      color: #eee;
      border: 1px solid #3a3a3c;
      border-radius: 8px;
      padding: 12px;
    }
    button {
      margin: 10px 5px 0 0;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    #loginBtn { background: #03dac6; }
    #logoutBtn { background: #e74c3c; color: #fff; display:none; }
    #saveBtn { background: #bb86fc; color:#000; display:none; }
  </style>
</head>
<body>
  <div class="app-container">
    <h1>Notlarım</h1>
    <p id="status">Lütfen giriş yapın.</p>
    <button id="loginBtn">Google ile Giriş Yap</button>
    <button id="logoutBtn">Çıkış Yap</button>
    <textarea id="note" placeholder="Notunuzu yazın..."></textarea><br>
    <button id="saveBtn">Kaydet</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAGapO0lBmLlJeiSPNXwj5gvE_fIXx2HwY",
      authDomain: "notlarim-ee58d.firebaseapp.com",
      databaseURL: "https://notlarim-ee58d-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "notlarim-ee58d",
      storageBucket: "notlarim-ee58d.firebasestorage.app",
      messagingSenderId: "104701316276",
      appId: "1:104701316276:web:6c40345fdd3eea9059dbe1",
      measurementId: "G-L5R3W846YL"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const noteBox = document.getElementById("note");
    const saveBtn = document.getElementById("saveBtn");
    const statusEl = document.getElementById("status");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    const noteRef = ref(db, "kerimNotData");

    // Oturum durumu değiştiğinde
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const email = user.email;
        // Sadece bu e-postalara izin ver
        const allowed = ["aschannel111@gmail.com","kerimdemirkaynak@yaani.com","bmgtr@gmail.com"];
        if (allowed.includes(email)) {
          statusEl.textContent = "Giriş başarılı: " + email;
          loginBtn.style.display = "none";
          logoutBtn.style.display = "inline-block";
          saveBtn.style.display = "inline-block";

          // Notları oku
          onValue(noteRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
              noteBox.value = data.content;
              statusEl.textContent = "Son kaydetme: " + new Date(data.timestamp).toLocaleString("tr-TR");
            } else {
              noteBox.value = "";
              statusEl.textContent = "Henüz not yok.";
            }
          });

        } else {
          statusEl.textContent = "Bu e-posta ile erişim izni yok: " + email;
          auth.signOut();
        }
      } else {
        statusEl.textContent = "Lütfen giriş yapın.";
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        saveBtn.style.display = "none";
        noteBox.value = "";
      }
    });

    // Giriş
    loginBtn.addEventListener("click", () => {
      signInWithPopup(auth, provider).catch(err => console.error(err));
    });

    // Çıkış
    logoutBtn.addEventListener("click", () => {
      signOut(auth);
    });

    // Kaydetme
    saveBtn.addEventListener("click", () => {
      const noteData = { content: noteBox.value, timestamp: Date.now() };
      set(noteRef, noteData)
        .then(() => statusEl.textContent = "Kaydedildi ✅")
        .catch(err => statusEl.textContent = "Kaydetme hatası: " + err);
    });
  </script>
</body>
</html>
