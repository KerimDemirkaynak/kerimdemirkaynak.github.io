<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Card Generator</title>
    <meta name="description" content="Anime & Drama Card Generator">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');

        :root {
            --bg-gradient: linear-gradient(135deg, #f6f8fd 0%, #e9ecf5 100%);
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --accent-color: #4F46E5;
            --accent-hover: #4338ca;
            --shadow-soft: 0 20px 40px rgba(0,0,0,0.08);
            --border-radius: 16px;
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #121212 0%, #1e1e1e 100%);
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --card-bg: #252525;
            --input-bg: #2a2a2a;
            --accent-color: #6366F1;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            margin: 0;
            min-height: 100vh;
            transition: 0.3s;
        }

        /* --- Üst Kısım --- */
        .header-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .mode-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid transparent;
            cursor: pointer;
            font-weight: 700;
            background: rgba(128,128,128,0.1);
            color: var(--text-secondary);
            transition: 0.2s;
        }

        .mode-btn.active {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* --- Arama Kutusu ve Dropdown --- */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-bottom: 40px;
            z-index: 100; /* Dropdown üstte kalsın */
        }

        .input-group {
            display: flex;
            gap: 10px;
            background: var(--card-bg);
            padding: 8px;
            border-radius: 12px;
            box-shadow: var(--shadow-soft);
        }

        input {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
        }

        button#search-btn {
            padding: 10px 20px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* AÇILIR LİSTE (Dropdown) */
        .search-results {
            position: absolute;
            top: 110%;
            left: 0;
            width: 100%;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-height: 300px;
            overflow-y: auto;
            display: none; /* Başlangıçta gizli */
        }

        .result-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(128,128,128,0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.2s;
        }

        .result-item:hover { background: rgba(128,128,128,0.05); }
        
        .thumb {
            width: 40px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            background: #ddd;
        }

        .item-info { display: flex; flex-direction: column; }
        .item-title { font-weight: 600; font-size: 14px; }
        .item-year { font-size: 12px; color: var(--text-secondary); }

        /* --- KART ALANI --- */
        /* Başlangıçta gizli olacak */
        .card-wrapper {
            display: none; 
            transform-origin: top center;
            box-shadow: var(--shadow-soft);
            border-radius: var(--border-radius);
        }

        /* Görünür olduğunda animasyonla gelsin */
        .card-wrapper.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #capture-area {
            width: 400px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
        }

        .anime-image-container {
            width: 100%;
            height: 350px;
            background: #ddd;
        }
        
        .anime-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
        }

        .info-container {
            padding: 24px;
            background: var(--card-bg);
            display: grid;
            grid-template-columns: max-content 1fr;
            column-gap: 15px;
            row-gap: 10px;
            align-items: baseline;
        }

        .anime-title {
            grid-column: 1 / -1;
            font-size: 26px;
            font-weight: 900;
            margin: 0 0 10px 0;
            line-height: 1.1;
            /* Sola hizalı */
            text-align: left; 
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .meta-label { font-size: 13px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
        .meta-value { font-size: 15px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .footer-row {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid rgba(128,128,128,0.1);
            font-weight: 700;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .score-box { display: flex; gap: 5px; color: var(--text-primary); font-size: 20px; }
        .star-icon { color: #FFD700; }

        /* İndir Butonu */
        #download-btn {
            margin-top: 30px;
            padding: 15px 40px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            display: none; /* Kart yoksa bu da yok */
        }

        @media (max-width: 450px) {
            .card-wrapper.visible { transform: scale(0.85); margin-bottom: -50px; }
        }
    </style>
</head>
<body>

    <div class="header-controls">
        <button class="mode-btn active" onclick="setMode('ANIME')">Anime (AniList)</button>
        <button class="mode-btn" onclick="setMode('DRAMA')">Drama (TVMaze)</button>
        <button class="mode-btn" onclick="toggleTheme()">Theme</button>
    </div>

    <div class="search-container">
        <div class="input-group">
            <input type="text" id="searchInput" placeholder="Anime adı yazın..." autocomplete="off">
            <button id="search-btn" onclick="performSearch()">Ara</button>
        </div>
        <div id="resultsList" class="search-results"></div>
    </div>

    <div class="card-wrapper" id="cardWrapper">
        <div id="capture-area">
            <div class="anime-image-container">
                <img id="poster" class="anime-image" src="" alt="Cover">
            </div>
            
            <div class="info-container">
                <h1 id="title" class="anime-title">TITLE</h1>
                
                <span class="meta-label" id="label-genre">Tür</span>
                <span class="meta-value" id="genres">-</span>
                
                <span class="meta-label" id="label-studio">Stüdyo / Kanal</span>
                <span class="meta-value" id="studio">-</span>

                <div class="footer-row">
                    <span id="season">-</span>
                    <div class="score-box">
                        <span class="star-icon">★</span>
                        <span id="score">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="download-btn" onclick="downloadCard()">Resmi İndir</button>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        // --- AYARLAR VE DURUM ---
        let currentMode = 'ANIME'; // 'ANIME' veya 'DRAMA'
        let currentLang = 'tr';
        
        // Çeviri Sözlüğü
        const genreMap = {
            'Action': 'Aksiyon', 'Adventure': 'Macera', 'Comedy': 'Komedi', 'Drama': 'Dram',
            'Fantasy': 'Fantastik', 'Horror': 'Korku', 'Romance': 'Romantizm', 'Sci-Fi': 'Bilim Kurgu',
            'Mystery': 'Gizem', 'Crime': 'Suç', 'Thriller': 'Gerilim', 'Family': 'Aile'
        };

        function setMode(mode) {
            currentMode = mode;
            // Butonları güncelle
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Placeholder güncelle
            const input = document.getElementById('searchInput');
            input.placeholder = mode === 'ANIME' ? 'Anime adı yazın...' : 'Dizi adı yazın (K-Drama vb.)...';
            input.value = '';
            
            // Listeyi ve kartı gizle
            document.getElementById('resultsList').style.display = 'none';
            document.getElementById('cardWrapper').classList.remove('visible');
            document.getElementById('download-btn').style.display = 'none';
        }

        // --- ARAMA FONKSİYONLARI ---
        async function performSearch() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            const list = document.getElementById('resultsList');
            list.innerHTML = '<div style="padding:15px; color:#666;">Aranıyor...</div>';
            list.style.display = 'block';

            if (currentMode === 'ANIME') {
                await searchAniList(query);
            } else {
                await searchTVMaze(query);
            }
        }

        // Enter tuşu desteği
        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') performSearch();
        });

        // --- 1. ANILIST API (Anime) ---
        async function searchAniList(search) {
            const query = `
            query ($search: String) {
              Page(page: 1, perPage: 5) {
                media(search: $search, type: ANIME, sort: SEARCH_MATCH) {
                  id
                  title { romaji english }
                  coverImage { medium extraLarge }
                  genres
                  averageScore
                  season
                  seasonYear
                  studios(isMain: true) { nodes { name } }
                }
              }
            }
            `;

            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query, variables: { search: search } })
                });
                const data = await response.json();
                renderList(data.data.Page.media, 'ANIME');
            } catch (e) {
                console.error(e);
                showError();
            }
        }

        // --- 2. TVMAZE API (Drama / Asya Dizileri) ---
        async function searchTVMaze(search) {
            try {
                const response = await fetch(`https://api.tvmaze.com/search/shows?q=${search}`);
                const data = await response.json();
                // TVMaze yapısı biraz farklı, array içinde { score, show } döner
                const shows = data.map(item => item.show); 
                renderList(shows, 'DRAMA');
            } catch (e) {
                console.error(e);
                showError();
            }
        }

        // --- LİSTELEME VE SEÇME ---
        function renderList(items, type) {
            const list = document.getElementById('resultsList');
            list.innerHTML = '';

            if (items.length === 0) {
                list.innerHTML = '<div style="padding:15px;">Sonuç bulunamadı.</div>';
                return;
            }

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'result-item';
                
                // Veri normalizasyonu
                let title, img, year;
                if (type === 'ANIME') {
                    title = item.title.english || item.title.romaji;
                    img = item.coverImage.medium;
                    year = item.seasonYear || '';
                } else {
                    title = item.name;
                    img = item.image ? item.image.medium : 'https://via.placeholder.com/40x50';
                    year = item.premiered ? item.premiered.substring(0, 4) : '';
                }

                div.innerHTML = `
                    <img src="${img}" class="thumb">
                    <div class="item-info">
                        <span class="item-title">${title}</span>
                        <span class="item-year">${year}</span>
                    </div>
                `;
                
                // Tıklayınca kartı doldur
                div.onclick = () => {
                    fillCard(item, type);
                    list.style.display = 'none'; // Listeyi kapat
                };
                
                list.appendChild(div);
            });
        }

        function fillCard(data, type) {
            const wrapper = document.getElementById('cardWrapper');
            const dlBtn = document.getElementById('download-btn');
            
            // Verileri doldur
            if (type === 'ANIME') {
                document.getElementById('poster').src = data.coverImage.extraLarge;
                document.getElementById('poster').crossOrigin = "Anonymous";
                
                document.getElementById('title').innerText = data.title.english || data.title.romaji;
                
                // Tür Çeviri
                let gs = data.genres.slice(0, 2).map(g => genreMap[g] || g);
                document.getElementById('genres').innerText = gs.join(', ');
                
                document.getElementById('studio').innerText = data.studios.nodes[0]?.name || '-';
                
                const sYear = data.seasonYear || '';
                const sName = data.season || ''; // WINTER, SUMMER vs.
                document.getElementById('season').innerText = `${sName} ${sYear}`;
                
                const score = data.averageScore ? (data.averageScore / 10).toFixed(1) : 'N/A';
                document.getElementById('score').innerText = `${score}/10`;

            } else {
                // TVMAZE VERİSİ
                const imgUrl = data.image ? data.image.original : 'https://via.placeholder.com/400x350';
                // TVMaze görselleri bazen CORS hatası verebilir, proxy gerekebilir ama genelde çalışır.
                const poster = document.getElementById('poster');
                poster.crossOrigin = "Anonymous";
                poster.src = imgUrl;

                document.getElementById('title').innerText = data.name;
                
                let gs = data.genres.slice(0, 2).map(g => genreMap[g] || g);
                document.getElementById('genres').innerText = gs.length > 0 ? gs.join(', ') : 'Drama';
                
                // TVMaze stüdyo değil "Network" verir
                document.getElementById('studio').innerText = data.network ? data.network.name : (data.webChannel ? data.webChannel.name : '-');
                
                const pDate = data.premiered || '';
                document.getElementById('season').innerText = pDate.substring(0, 4); // Sadece Yıl
                
                const score = data.rating.average ? data.rating.average : 'N/A';
                document.getElementById('score').innerText = `${score}/10`;
            }

            // Kartı görünür yap
            wrapper.classList.add('visible');
            dlBtn.style.display = 'block';
        }

        // --- İNDİRME VE DİĞERLERİ ---
        function downloadCard() {
            const element = document.getElementById('capture-area');
            const wrapper = document.querySelector('.card-wrapper');
            const dlBtn = document.getElementById('download-btn');

            dlBtn.style.display = 'none';
            wrapper.style.transform = 'none'; 
            wrapper.style.boxShadow = 'none';
            element.style.borderRadius = '0'; 

            html2canvas(element, {
                useCORS: true,
                scale: 3,
                backgroundColor: null
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `card_${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                dlBtn.style.display = 'block';
                wrapper.style.transform = ''; 
                wrapper.style.boxShadow = '';
                element.style.borderRadius = '';
            });
        }

        function toggleTheme() {
            const body = document.body;
            body.setAttribute('data-theme', body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        }

        function showError() {
            document.getElementById('resultsList').innerHTML = '<div style="color:red; padding:10px;">Hata oluştu.</div>';
        }
        
        // Dışarı tıklayınca listeyi kapat
        document.addEventListener('click', function(event) {
            const container = document.querySelector('.search-container');
            if (!container.contains(event.target)) {
                document.getElementById('resultsList').style.display = 'none';
            }
        });
    </script>
</body>
</html>
