<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Anime Takvimi</title>

  <!-- Sosyal Medya Meta Etiketleri -->
  <meta property="og:title" content="Anime Takvimi">
  <meta property="og:description" content="Yeni anime bölümleri ne zaman yayınlanacak? Anilist verileriyle anlık geri sayım.">
  <meta property="og:image" content="https://kerimdemirkaynak.github.io/resimler/20241121_055155.jpg">
  <meta property="og:url" content="https://kerimdemirkaynak.github.io/">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Favicon -->
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/AniList_logo.svg/250px-AniList_logo.svg.png" type="image/png">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: white;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background: #1e1e1e;
      border-bottom: 1px solid #2c2c2c;
    }
    header img {
      height: 32px;
      margin-right: 10px;
    }
    header h1 {
      font-family: 'Russo One', sans-serif;
      font-size: 20px;
      margin: 0;
      color: #4fc3f7;
    }
    main {
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 30px;
    }
    .anime-card {
      display: flex;
      flex-direction: column;
      background: #1e1e1e;
      border-radius: 12px;
      margin: 12px 0;
      padding: 12px;
    }
    .anime-top {
      display: flex;
      gap: 16px;
    }
    .anime-image img {
      width: 120px;
      height: 170px;
      object-fit: cover;
      border-radius: 10px;
    }
    .anime-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .anime-title {
      font-family: 'Russo One', sans-serif;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 6px;
      word-break: break-word;
      color: #4fc3f7;
      cursor: pointer;
    }
    .anime-title:hover {
      text-decoration: underline;
    }
    .episode-number {
      font-size: 16px;
      font-weight: bold;
      color: #e0e0e0;
    }
    .airing-time {
      font-size: 14px;
      color: #b0b0b0;
      margin: 4px 0;
    }
    .platform-links {
      margin-top: 6px;
    }
    .platform-links a {
      display: inline-block;
      margin-right: 6px;
      height: 22px;
    }
    .platform-links img {
      height: 100%;
      object-fit: contain;
      filter: brightness(0) invert(1);
      transition: transform 0.2s ease;
    }
    .platform-links a:hover img {
      transform: scale(1.1);
    }
    .info-button {
      margin-top: 10px;
      background: #333;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #1e1e1e;
      margin: 10% auto;
      padding: 20px;
      width: 90%;
      max-width: 360px;
      border-radius: 10px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: white;
    }

    footer {
      text-align: center;
      font-size: 13px;
      padding: 20px;
      background: #1e1e1e;
      border-top: 1px solid #2c2c2c;
    }
    footer a {
      color: #4fc3f7;
      text-decoration: none;
      margin: 0 10px;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/61/AniList_logo.svg" alt="Logo">
    <h1>Anime Takvimi</h1>
  </header>

  <main>
    <h2>Yeni Anime Bölümleri</h2>
    <div id="animeList"></div>
  </main>

  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="document.getElementById('infoModal').style.display='none'">&times;</span>
      <div id="modalContent"></div>
    </div>
  </div>

  <footer>
    <p>
      <a href="https://kerimdemirkaynak.github.io/">Ana Sayfa</a> |
      <a href="https://kerimdemirkaynak.github.io/hakkinda">Hakkında</a> |
      <a href="https://kerimdemirkaynak.github.io/iletisim">İletişim</a>
    </p>
    <p>© <span id="year"></span> Kerim Demirkaynak - Tüm hakları saklıdır</p>
  </footer>

 <script>
  document.getElementById('year').textContent = new Date().getFullYear();

  const platformLogos = {
    "Crunchyroll": "https://upload.wikimedia.org/wikipedia/commons/d/d9/Crunchyroll_2024.svg",
    "HIDIVE": "https://upload.wikimedia.org/wikipedia/commons/5/5f/Hidive_text_logo.svg",
    "YouTube": "https://upload.wikimedia.org/wikipedia/commons/0/08/YouTube_light_logo_%282024%29.svg"
  };
  const monthNames = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];

  function getCurrentSeasonAndYear() {
    const date = new Date();
    const month = date.getMonth(); // 0 = Ocak
    const year = date.getFullYear();

    let season = 'WINTER';
    if (month >= 2 && month <= 4) season = 'SPRING';
    else if (month >= 5 && month <= 7) season = 'SUMMER';
    else if (month >= 8 && month <= 10) season = 'FALL';

    return { season, year };
  }

  async function getAnimeList() {
    const { season, year } = getCurrentSeasonAndYear();

    const query = `query {
      Page(perPage: 50) {
        media(season: ${season}, seasonYear: ${year}, type: ANIME, sort: POPULARITY_DESC) {
          id
          title { romaji }
          coverImage { medium }
          startDate { year month day }
          nextAiringEpisode {
            airingAt
            episode
          }
          isAdult
          genres
          tags { name }
          averageScore
          externalLinks { site url }
        }
      }
    }`;

    const response = await fetch('https://graphql.anilist.co', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query })
    });

    const data = await response.json();
    const container = document.getElementById('animeList');
    container.innerHTML = '';
    const now = Math.floor(Date.now() / 1000);

    data.data.Page.media.forEach(anime => {
      if (anime.isAdult || !anime.nextAiringEpisode) return;

      const ep = anime.nextAiringEpisode;
      const link = `https://anilist.co/anime/${anime.id}`;
      const diff = ep.airingAt - now;

      let airingText = '';
      const days = Math.floor(diff / 86400);
      const hours = Math.floor((diff % 86400) / 3600);
      const minutes = Math.floor((diff % 3600) / 60);

      if (diff > 0) {
        airingText = `${days > 0 ? days + ' gün ' : ''}${hours} saat ${minutes} dakika sonra yayınlanacak`;
      } else {
        const ago = Math.abs(diff);
        const hoursAgo = Math.floor(ago / 3600);
        const minutesAgo = Math.floor((ago % 3600) / 60);
        airingText = `${hoursAgo > 0 ? hoursAgo + ' saat ' : ''}${minutesAgo} dakika önce yayınlandı`;
      }

      const episodeText = `${ep.episode}. Bölüm`;

      let platformHTML = '';
      anime.externalLinks.forEach(link => {
        if (platformLogos[link.site]) {
          platformHTML += `<a href="${link.url}" target="_blank"><img src="${platformLogos[link.site]}" alt="${link.site}"></a>`;
        }
      });

      const genres = anime.genres.join(', ');
      const tags = anime.tags.slice(0, 3).map(t => t.name).join(', ');
      const score = anime.averageScore ? `${(anime.averageScore / 10).toFixed(1)} / 10` : 'Puan yok';
      const monthText = anime.startDate?.month ? monthNames[anime.startDate.month - 1] : '';
      const startDate = anime.startDate?.year && monthText ? `${anime.startDate.day ? anime.startDate.day + ' ' : ''}${monthText}, ${anime.startDate.year}` : 'Bilinmiyor';

      const card = document.createElement('div');
      card.className = 'anime-card';
      card.innerHTML = `
        <div class="anime-top">
          <div class="anime-image">
            <img src="${anime.coverImage.medium}" alt="${anime.title.romaji}">
          </div>
          <div class="anime-info">
            <div class="anime-title" onclick="window.open('${link}', '_blank')">${anime.title.romaji}</div>
            <div class="episode-number">${episodeText}</div>
            <div class="airing-time">${airingText}</div>
            <div class="platform-links">${platformHTML}</div>
            <button class="info-button" onclick="showInfo(event, \`${startDate}\`, \`${genres}\`, \`${tags}\`, \`${score}\`)">Daha fazla bilgi</button>
          </div>
        </div>
      `;
      container.appendChild(card);
    });
  }

  function showInfo(event, date, genres, tags, score) {
    event.stopPropagation();
    const modal = document.getElementById('infoModal');
    const content = document.getElementById('modalContent');
    content.innerHTML = `
      <p><strong>Başlangıç:</strong> ${date}</p>
      <p><strong>Tür:</strong> ${genres}</p>
      <p><strong>Temalar:</strong> ${tags}</p>
      <p><strong>Puan:</strong> ${score}</p>
    `;
    modal.style.display = 'block';
  }

  window.onclick = function(event) {
    const modal = document.getElementById('infoModal');
    if (event.target == modal) {
      modal.style.display = 'none';
    }
  };

  getAnimeList();
</script>
</body>
</html>
